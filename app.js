!function(){"use strict";var t="undefined"==typeof global?self:global;if("function"!=typeof t.require){var e={},r={},i={},n={}.hasOwnProperty,a=/^\.\.?(\/|$)/,s=function(t,e){for(var r,i=[],n=(a.test(e)?t+"/"+e:e).split("/"),s=0,o=n.length;s<o;s++)r=n[s],".."===r?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},o=function(t){return t.split("/").slice(0,-1).join("/")},u=function(e){return function(r){var i=s(o(e),r);return t.require(i,e)}},l=function(t,e){var i=v&&v.createHot(t),n={id:t,exports:{},hot:i};return r[t]=n,e(n.exports,u(t),n),n.exports},c=function(t){return i[t]?c(i[t]):t},h=function(t,e){return c(s(o(t),e))},d=function(t,i){null==i&&(i="/");var a=c(t);if(n.call(r,a))return r[a].exports;if(n.call(e,a))return l(a,e[a]);throw new Error("Cannot find module '"+t+"' from '"+i+"'")};d.alias=function(t,e){i[e]=t};var f=/\.[^.\/]+$/,m=/\/index(\.[^\/]+)?$/,_=function(t){if(f.test(t)){var e=t.replace(f,"");n.call(i,e)&&i[e].replace(f,"")!==e+"/index"||(i[e]=t)}if(m.test(t)){var r=t.replace(m,"");n.call(i,r)||(i[r]=t)}};d.register=d.define=function(t,i){if(t&&"object"==typeof t)for(var a in t)n.call(t,a)&&d.register(a,t[a]);else e[t]=i,delete r[t],_(t)},d.list=function(){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t};var v=t._hmr&&new t._hmr(h,d,e,r);d._cache=r,d.hmr=v&&v.wrap,d.brunch=!0,t.require=d}}(),function(){"undefined"==typeof window?this:window;require.register("common.js",function(t,e,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GridStateEnum=Object.freeze({Question:-3,Unknown:-2,Flag:-1,N0:0,N1:1,N2:2,N3:3,N4:4,N5:5,N6:6,N7:7,N8:8,MineRevealed:64,MineClicked:65,WrongFlag:66})}),require.register("game.js",function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0}),t.GameState=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=e("../lib/emitter"),l=i(u),c=e("common"),h=e("generator");t.GameState=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:99,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,e);var o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));o.w=r,o.h=t,o.n=i,o.seed=s,o.dead=!1,o.won=!1,o.mines=null,o.grid=[];for(var u=0;u<t;u++)for(var l=0;l<r;l++)o.grid[u*r+l]=-2;return o}return s(e,t),o(e,[{key:"open",value:function(t,e){var r=this.w,i=this.h;if(!(0<=t&&t<r&&0<=e&&e<i))throw new Error("coordinate(s) out of range");if(null==this.mines&&(this.mines=h.ClassicGenerator.generate(i,r,this.n,t,e,this.seed),this.emit("start")),this.mines[e*r+t])return this.dead=!0,this.grid[e*r+t]=c.GridStateEnum.MineClicked,this.emit("end",!1),!1;var n=[];n.push({x:t,y:e});for(var a=0;a<n.length;a++){var s=n[a],o=s.x,u=s.y;if(this.mines[u*r+o])throw new Error("tried to auto-clear a mine");for(var l=0,d=-1;d<=1;d++)for(var f=-1;f<=1;f++)o+d>=0&&o+d<r&&u+f>=0&&u+f<i&&this.mines[(u+f)*r+(o+d)]&&l++;if(this.grid[u*r+o]=l,0===l)for(var m=-1;m<=1;m++)for(var _=-1;_<=1;_++)o+m>=0&&o+m<r&&u+_>=0&&u+_<i&&this.grid[(u+_)*r+(o+m)]===c.GridStateEnum.Unknown&&n.push({x:o+m,y:u+_})}for(var v=0,p=0,u=0;u<i;u++)for(var o=0;o<r;o++)this.grid[u*r+o]<0&&p++,this.mines[u*r+o]&&v++;if(p<v)throw new Error("uncovered a mine without losing?");if(p===v){for(var w=0;w<i;w++)for(var g=0;g<r;g++)this.grid[w*r+g]<0&&(this.grid[w*r+g]=c.GridStateEnum.Flag);return this.won=!0,this.emit("end",!0),!1}return!0}}]),e}(l["default"])}),require.register("generator.js",function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=[],i=0;i<e;i++)r[i]=t;return r}Object.defineProperty(t,"__esModule",{value:!0}),t.FairGenerator=t.ClassicGenerator=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function _(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:_(n,e,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=e("../lib/xor4096"),d=i(h),f=e("solver"),m=t.ClassicGenerator=function(){function t(){s(this,t)}return c(t,null,[{key:"generate",value:function(t,e,r,i,n,a){if(r>e*t-9)throw new Error("too many mines for grid size");for(var s=o(0,e*t),u=null==a||null==a.uint32_range?(0,d["default"])(a):a,l=o(0,e*t),c=0,h=0;h<t;h++)for(var f=0;f<e;f++)(Math.abs(h-n)>1||Math.abs(f-i)>1)&&(l[c++]=h*e+f);for(var m=r;m-- >0;){var _=u.uint32_range(c);s[l[_]]=1,l[_]=l[--c]}return s}}]),t}();t.FairGenerator=function(t){function e(){return s(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),c(e,null,[{key:"generate",value:function(t,r,i,n,a,s){if(r<=2||t<=2)throw new Error("grid dimensions must be at least 3x3");var c="object"!==("undefined"==typeof s?"undefined":u(s))?(0,d["default"])(s):s,h=void 0,m=void 0,_=0;do{m=!1,_++,h=l(e.__proto__||Object.getPrototypeOf(e),"generate",this).call(this,t,r,i,n,a,c);for(var v=new f.Solver(h,r,t,i,n,a,c,_>100),p=void 0,w=-2;;){if(v.state=o(-2,r*t),v.state[a*r+n]=v.open(n,a),0!==v.state[a*r+n])throw new Error("Generation broken, first square not empty");if(p=v.solve(),p<0||w>=0&&p>=w){m=!1;break}if(0===p){m=!0;break}}}while(!m);return h}}]),e}(m)}),require.register("main.js",function(t,e,r){"use strict";e("../lib/dragable");var i=e("game"),n=e("ui");window.renderer=new n.GameWindow(document.getElementsByClassName("minefield")[0],new i.GameState(16,30,99),document.getElementsByClassName("indicator")),document.getElementsByClassName("yellow")[0].addEventListener("click",function(){return window.renderer.init(null,new i.GameState(16,30,99),null)})}),require.register("solver.js",function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r,n,a,s,o,u,l){i(this,t),this.grid=e,this.w=r,this.h=n,this.n=a,this.state=[],this.sx=s,this.sy=o,this.rng=u,this.allow_big_perturbs=l}return n(t,[{key:"open",value:function(t,e){if(!(t>=0&&t<this.w&&e>=0&&e<this.h))throw new Error("coordinates out of range");if(this.grid[e*this.w+t])return-1;for(var r=0,i=-1;i<=1;i++)if(!(t+i<0||t+i>=this.w))for(var n=-1;n<=1;n++)e+n<0||e+n>=this.h||0===i&&0===n||this.grid[(e+n)*this.w+(t+i)]&&r++;return r}},{key:"solve",value:function(){return 0}}]),t}();t.Solver=a}),require.register("ui.js",function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GameWindow=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=e("common");t.GameWindow=function(){function t(e,r,n){var a=this;i(this,t),this.init(e,r,n),e.addEventListener("mousedown",this.onmousedown.bind(this)),e.addEventListener("mouseup",this.onmouseup.bind(this)),e.addEventListener("mousemove",this.onmousemove.bind(this)),e.addEventListener("mouseleave",function(){a._x_last=null,a._y_last=null,a.redraw_anim()}),e.addEventListener("contextmenu",function(t){return t.preventDefault()}),document.addEventListener("keypress",this.onkeypress.bind(this))}return n(t,[{key:"init",value:function(t,e,r){var i=this;for(this.root=t||this.root,this.state=e||this.state,this._grid=[],this.state.on("start",this.onstart.bind(this)),this.state.on("end",this.onend.bind(this));this.root.firstChild;)this.root.removeChild(this.root.firstChild);for(var n=0;n<e.h;n++){var a=document.createElement("div");a.className="row";for(var s=0;s<e.w;s++){var o=document.createElement("div");o.className="tile closed",o.dataset.coord=""+s+"x"+n,this._grid[n*e.w+s]=o,a.appendChild(o)}this.root.appendChild(a)}this.indicator_flags=r?r[0]:this.indicator_flags,this._flags_remain=null,this.indicator_yellow=r?r[1]:this.indicator_yellow,this.indicator_yellow.className="indicator yellow happy",this.indicator_clock=r?r[2]:this.indicator_clock,this.time_start=null,this.time_stop=null,this._chord_last=null,this._x_last=null,this._y_last=null,this._draw_queue=[],this._anim_queue=[],requestAnimationFrame(function(){i.indicator_flags.textContent="!!!",i.indicator_clock.textContent="!!!"})}},{key:"destroy",value:function(){this.root=null,this.state=null,this._grid=null,this.time_start=null}},{key:"onstart",value:function(){var t=this;this.time_start=Date.now(),this._flags_remain=this.state.n,requestAnimationFrame(function(){return t.tick()})}},{key:"onend",value:function(t){var e=this;if(this.time_stop=Date.now(),t)for(var r=0;r<this.state.h*this.state.w;r++)this.state.mines[r]&&this.state.grid[r]===a.GridStateEnum.Unknown&&(this.state.grid[r]=a.GridStateEnum.Flag);else for(var i=0;i<this.state.h*this.state.w;i++)this.state.mines[i]?this.state.grid[i]===a.GridStateEnum.Unknown&&(this.state.grid[i]=a.GridStateEnum.MineRevealed):this.state.grid[i]===a.GridStateEnum.Flag&&(this.state.grid[i]=a.GridStateEnum.WrongFlag);requestAnimationFrame(function(){e.indicator_yellow.classList.remove("surprise","happy"),e.indicator_yellow.classList.add(t?"cool":"dead"),e.redraw_full()})}},{key:"onmousedown",value:function(t){var e=this;if(t.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var r=t.target.dataset.coord.split("x"),i=parseInt(r[0],10),n=parseInt(r[1],10);2===t.button&&2===t.buttons||0===t.button&&t.ctrlKey?this._flag(i,n):0===t.button&&1===t.buttons?requestAnimationFrame(function(){e.state.grid[n*e.state.w+i]===a.GridStateEnum.Unknown&&(e._grid[n*e.state.w+i].className="tile open",e._anim_queue.push(n*e.state.w+i)),e.indicator_yellow.classList.replace("happy","surprise")}):(2===t.button&&1&t.buttons||0===t.button&&2&t.buttons)&&(this._chord_last=null,requestAnimationFrame(function(){for(var t=e.state.w,r=e.state.h,s=-1;s<=1;s++)for(var o=-1;o<=1;o++)i+s>=0&&i+s<t&&n+o>=0&&n+o<r&&e.state.grid[(n+o)*t+(i+s)]===a.GridStateEnum.Unknown&&(e._grid[(n+o)*t+(i+s)].className="tile open",e._anim_queue.push((n+o)*t+(i+s)))})),t.preventDefault()}}},{key:"onmouseup",value:function(t){var e=this;if(t.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var r=t.target.dataset.coord.split("x"),i=parseInt(r[0],10),n=parseInt(r[1],10);n*this.state.w+i;0===t.button&&2&t.buttons||2===t.button&&1&t.buttons||1===t.button?(this._chord(i,n),this.state.won||this.state.dead||requestAnimationFrame(function(){e.indicator_yellow.className="indicator yellow happy",e.redraw_anim()})):0!==t.button||t.ctrlKey||this._chord_last||this._open(i,n)&&requestAnimationFrame(function(){e.indicator_yellow.className="indicator yellow happy",e.redraw_anim()}),1&t.buttons&&2===t.button?this._chord_last=!0:this._chord_last=null,t.preventDefault()}}},{key:"onmousemove",value:function(t){var e=this;if(t.path[0].className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var r=t.path[0].dataset.coord.split("x"),i=parseInt(r[0],10),n=parseInt(r[1],10);this._x_last===i&&this._y_last===n||(this._x_last=i,this._y_last=n,0===t.buttons||this._chord_last||requestAnimationFrame(function(){var r=e.state.w,s=e.state.h;if(e.redraw_anim(),3===(3&t.buttons))for(var o=-1;o<=1;o++)for(var u=-1;u<=1;u++)i+o>=0&&i+o<r&&n+u>=0&&n+u<s&&e.state.grid[(n+u)*r+(i+o)]===a.GridStateEnum.Unknown&&(e._grid[(n+u)*r+(i+o)].className="tile open",e._anim_queue.push((n+u)*r+(i+o)));else 1&t.buttons&&e.state.grid[n*r+i]===a.GridStateEnum.Unknown&&(e._grid[n*r+i].className="tile open",e._anim_queue.push(n*r+i))}))}}},{key:"onkeypress",value:function(t){if(!this.state.won&&!this.state.dead&&"Space"===t.code&&null!=this._x_last&&null!=this._y_last){var e=this._y_last*this.state.w+this._x_last;this.state.grid[e]===a.GridStateEnum.Unknown||this.state.grid[e]===a.GridStateEnum.Flag?this._flag(this._x_last,this._y_last):1<=this.state.grid[e]&&this.state.grid[e]<=8&&this._chord(this._x_last,this._y_last),t.preventDefault()}}},{key:"redraw_full",value:function(){for(var t=0;t<this.state.h;t++)for(var e=0;e<this.state.w;e++)this.redraw(t*this.state.w+e)}},{key:"redraw_anim",value:function(){var t=!0,e=!1,r=void 0;try{for(var i,n=this._anim_queue[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var a=i.value;this.redraw(a)}}catch(s){e=!0,r=s}finally{try{!t&&n["return"]&&n["return"]()}finally{if(e)throw r}}}},{key:"redraw",value:function(t){switch(this.state.grid[t]){case a.GridStateEnum.Unknown:this._grid[t].className="tile closed";break;case a.GridStateEnum.Flag:this._grid[t].className="tile closed flag";break;case a.GridStateEnum.MineRevealed:this._grid[t].className="tile closed mine";break;case a.GridStateEnum.MineClicked:this._grid[t].className="tile open red mine";break;case a.GridStateEnum.WrongFlag:this._grid[t].className="tile closed nomine";break;default:this._grid[t].className="tile open n"+this.state.grid[t]}}},{key:"tick",value:function(){var t=this,e=(this.time_stop||Date.now())-this.time_start;this.indicator_clock.textContent=(""+(~~(e/1e3)+1)).padStart(3,"0"),null!=this.time_stop&&this.indicator_clock.setAttribute("title",~~(e/6e4)+":"+e/1e3%60),this.indicator_flags.textContent=(""+this._flags_remain).padStart(3,"0");var r=!0,i=!1,n=void 0;try{for(var a,s=this._draw_queue[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;this.redraw(o)}}catch(u){i=!0,n=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw n}}null==this.time_stop&&null!=this.time_start&&requestAnimationFrame(function(){return t.tick()})}},{key:"_open",value:function(t,e){var r=this;if(this.state.grid[e*this.state.w+t]===a.GridStateEnum.Unknown){var i=this.state.open(t,e);return requestAnimationFrame(function(){return r.redraw_full()}),i}return!0}},{key:"_flag",value:function(t,e){var r=e*this.state.w+t;null!=this.time_start&&(this.state.grid[r]===a.GridStateEnum.Unknown?(this.state.grid[r]=a.GridStateEnum.Flag,this._draw_queue.push(r),this._flags_remain-=1):this.state.grid[r]===a.GridStateEnum.Flag&&(this.state.grid[r]=a.GridStateEnum.Unknown,this._draw_queue.push(r),this._flags_remain+=1))}},{key:"_chord",value:function(t,e){var r=this,i=this.state.w,n=this.state.h,s=e*i+t;if(null!=this.time_start&&1<=this.state.grid[s]&&this.state.grid[s]<=8){for(var o=0,u=-1;u<=1;u++)for(var l=-1;l<=1;l++)t+u>=0&&t+u<i&&e+l>=0&&e+l<n&&this.state.grid[(e+l)*i+(t+u)]===a.GridStateEnum.Flag&&o++;if(o===this.state.grid[s])for(var c=-1;c<=1;c++)for(var h=-1;h<=1;h++)t+c>=0&&t+c<i&&e+h>=0&&e+h<n&&this.state.grid[(e+h)*i+(t+c)]===a.GridStateEnum.Unknown&&this.state.open(t+c,e+h);requestAnimationFrame(function(){return r.redraw_full()})}}}]),t}()}),require.register("___globals___",function(t,e,r){})}(),require("___globals___");