!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},i={},n={},r={}.hasOwnProperty,s=/^\.\.?(\/|$)/,o=function(e,t){for(var i,n=[],r=(s.test(t)?e+"/"+t:t).split("/"),o=0,a=r.length;o<a;o++)i=r[o],".."===i?n.pop():"."!==i&&""!==i&&n.push(i);return n.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(i){var n=o(a(t),i);return e.require(n,t)}},u=function(e,t){var n=v&&v.createHot(e),r={id:e,exports:{},hot:n};return i[e]=r,t(r.exports,l(e),r),r.exports},c=function(e){return n[e]?c(n[e]):e},h=function(e,t){return c(o(a(e),t))},d=function(e,n){null==n&&(n="/");var s=c(e);if(r.call(i,s))return i[s].exports;if(r.call(t,s))return u(s,t[s]);throw new Error("Cannot find module '"+e+"' from '"+n+"'")};d.alias=function(e,t){n[t]=e};var f=/\.[^.\/]+$/,m=/\/index(\.[^\/]+)?$/,p=function(e){if(f.test(e)){var t=e.replace(f,"");r.call(n,t)&&n[t].replace(f,"")!==t+"/index"||(n[t]=e)}if(m.test(e)){var i=e.replace(m,"");r.call(n,i)||(n[i]=e)}};d.register=d.define=function(e,n){if(e&&"object"==typeof e)for(var s in e)r.call(e,s)&&d.register(s,e[s]);else t[e]=n,delete i[e],p(e)},d.list=function(){var e=[];for(var i in t)r.call(t,i)&&e.push(i);return e};var v=e._hmr&&new e._hmr(h,d,t,i);d._cache=i,d.hmr=v&&v.wrap,d.brunch=!0,e.require=d}}(),function(){"undefined"==typeof window?this:window;require.register("common.js",function(e,t,i){"use strict";function n(e){for(var t=5381,i=e.length;i--;)t=(t<<5)+t+e.charCodeAt(i);return t}function r(e){return u[n(e)%u.length]}function s(e){return e.H+"x"+e.W+", "+e.N}function o(e){var t=s(e);return e.Difficulty!==l.Custom&&(t=l.str(e.Difficulty)+" ("+t+")"),e.Mode!==a.Solo&&(t=a.str(e.Mode)+" "+t),t}Object.defineProperty(e,"__esModule",{value:!0}),e.djb2=n,e.colorstr=r,e.sizef=s,e.labelf=o;var a=(e.GridStateEnum=Object.freeze({Question:-3,Unknown:-2,Flag:-1,N0:0,N1:1,N2:2,N3:3,N4:4,N5:5,N6:6,N7:7,N8:8,MineRevealed:64,MineClicked:65,WrongFlag:66}),e.MinesweeperMode=Object.freeze({Solo:"solo",Coop:"coop",Race:"race",Attack:"attack",str:function(e){switch(e){case a.Solo:return"Solo";case a.Coop:return"Co-op";case a.Race:return"Race";case a.Attack:return"Attack";default:return"Unknown"}}})),l=e.MinesweeperDifficulty=Object.freeze({Beginner:"beg",Intermediate:"int",Expert:"exp",Extreme:"ext",Custom:"cus",str:function(e){switch(e){case l.Beginner:return"Beginner";case l.Intermediate:return"Intermediate";case l.Expert:return"Expert";case l.Extreme:return"Extreme";default:return"Custom"}}}),u=e.DistinctColors=Object.freeze(["#4c1313","#ffd9bf","#eef2b6","#3df2e6","#293aa6","#f23dce","#7f4040","#99754d","#3a5916","#1a6166","#6c7bd9","#73004d","#ffbfbf","#cc8800","#7db359","#40d9ff","#a099cc","#e5007a","#ff2200","#ffd580","#00ff00","#00a2f2","#853df2","#664d57","#f29979","#735c00","#86b39e","#5995b3","#4d0073","#ff0044","#592400","#807d60","#00f2a2","#334766","#673973","#d96c89","#b2622d","#c2cc33","#008c5e","#000a4d","#ffbffb","#a60016"])}),require.register("engine.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.GameState=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=t("component-emitter"),u=n(l),c=t("common"),h=t("generator");e.GameState=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:99,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));a.w=i,a.h=e,a.n=n,a.seed=o,a.dead=!1,a.won=!1,a.mines=null,a.grid=[];for(var l=0;l<e;l++)for(var u=0;u<i;u++)a.grid[l*i+u]=-2;return a}return o(t,e),a(t,[{key:"open",value:function(e,t){var i=this.w,n=this.h;if(!(0<=e&&e<i&&0<=t&&t<n))throw new Error("coordinate(s) out of range");if(null==this.mines&&(this.mines=h.ClassicGenerator.generate(n,i,this.n,e,t,this.seed),this.emit("start")),this.mines[t*i+e])return this.dead=!0,this.grid[t*i+e]=c.GridStateEnum.MineClicked,this.emit("end",!1),!1;var r=[];r.push({x:e,y:t});for(var s=0;s<r.length;s++){var o=r[s],a=o.x,l=o.y;if(this.mines[l*i+a])throw new Error("tried to auto-clear a mine");for(var u=0,d=-1;d<=1;d++)for(var f=-1;f<=1;f++)a+d>=0&&a+d<i&&l+f>=0&&l+f<n&&this.mines[(l+f)*i+(a+d)]&&u++;if(this.grid[l*i+a]=u,0===u)for(var m=-1;m<=1;m++)for(var p=-1;p<=1;p++)a+m>=0&&a+m<i&&l+p>=0&&l+p<n&&this.grid[(l+p)*i+(a+m)]===c.GridStateEnum.Unknown&&r.push({x:a+m,y:l+p})}for(var v=0,y=0,l=0;l<n;l++)for(var a=0;a<i;a++)this.grid[l*i+a]<0&&y++,this.mines[l*i+a]&&v++;if(y<v)throw new Error("uncovered a mine without losing?");if(y===v){for(var g=0;g<n;g++)for(var w=0;w<i;w++)this.grid[g*i+w]<0&&(this.grid[g*i+w]=c.GridStateEnum.Flag);return this.won=!0,this.emit("end",!0),!1}return!0}},{key:"toJSON",value:function(){return{w:this.w,h:this.h,n:this.n,seed:this.seed,dead:this.dead,won:this.won,mines:this.mines,grid:this.grid}}}],[{key:"fromJSON",value:function(e){var t=new this(e.h,e.w,e.n,e.seed);return t.dead=e.dead,t.won=e.won,t.mines=e.mines,t.grid=e.grid,t}}]),t}(u["default"])}),require.register("generator.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=[],n=0;n<t;n++)i[n]=e;return i}Object.defineProperty(e,"__esModule",{value:!0}),e.FairGenerator=e.ClassicGenerator=void 0;var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function y(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:y(r,t,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=t("../lib/xor4096"),d=n(h),f=t("solver"),m=e.ClassicGenerator=function(){function e(){o(this,e)}return c(e,null,[{key:"generate",value:function(e,t,i,n,r,s){if(i>t*e-9)throw new Error("too many mines for grid size");for(var o=a(0,t*e),l=null==s||null==s.uint32_range?(0,d["default"])(s):s,u=a(0,t*e),c=0,h=0;h<e;h++)for(var f=0;f<t;f++)(Math.abs(h-r)>1||Math.abs(f-n)>1)&&(u[c++]=h*t+f);for(var m=i;m-- >0;){var p=l.uint32_range(c);o[u[p]]=1,u[p]=u[--c]}return o}}]),e}(),p=null,v=null;e.FairGenerator=function(e){function t(){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),c(t,null,[{key:"generate",value:function(e,i,n,r,s,o){if(i<=2||e<=2)throw new Error("grid dimensions must be at least 3x3");var c="object"!==("undefined"==typeof o?"undefined":l(o))?(0,d["default"])(o):o,h=void 0,m=void 0,p=0;do{m=!1,p++,h=u(t.__proto__||Object.getPrototypeOf(t),"generate",this).call(this,e,i,n,r,s,c);for(var v=new f.Solver(h,i,e,n,r,s,c,p>100),y=void 0,g=-2;;){if(v.state=a(-2,i*e),v.state[s*i+r]=v.open(r,s),0!==v.state[s*i+r])throw new Error("Generation broken, first square not empty");if(y=v.solve(),y<0||g>=0&&y>=g){m=!1;break}if(0===y){m=!0;break}}}while(!m);return h}},{key:"generate_async",value:function(e,i,n,r,s,o){var a=this;if(i<=2||e<=2)throw new Error("grid dimensions must be at least 3x3");var c="object"!==("undefined"==typeof o?"undefined":l(o))?(0,d["default"])(o):o;return new Promise(function(o){null==p&&(p=new Worker("solve.worker.js"),p.onmessage=function(e){null!=v&&v(e.data)});var l=void 0;(v=function(h){0===h?(v=null,o(l)):(l=u(t.__proto__||Object.getPrototypeOf(t),"generate",a).call(a,e,i,n,r,s,c),p.postMessage({grid:l,w:i,h:e,n:n,sx:r,sy:s,rng:c,allow_big_perturbs:!1}))})(-1)})}}]),t}(m)}),require.register("main.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){var t=document.querySelector("main"),i=document.createElement("div");i.classList.add("alert","window");var n=document.createElement("div");n.classList.add("titlebar"),n.textContent="Alert",i.appendChild(n);var r=document.createElement("div");r.textContent=e,i.appendChild(r);var s=document.createElement("div");s.classList.add("toolbar-bottom");var o=document.createElement("a");o.classList.add("button","alert-ok"),o.textContent="  OK  ",o.addEventListener("click",function(){t.removeChild(i)}),s.appendChild(o),i.appendChild(s),requestAnimationFrame(function(){return t.appendChild(i)})}Object.defineProperty(e,"__esModule",{value:!0}),e.Manager=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=t("../lib/dragable"),l=n(a),u=t("engine"),c=t("online"),h=t("wgame"),d=t("wrecords"),f=n(d),m=t("wsettings"),p=n(m),v=t("./common"),y=t("wchat"),g=n(y),w=e.Manager=function(){function e(){var t=this;r(this,e),this.wmain=document.getElementById("main-game"),this.mfield=this.wmain.querySelector(".minefield"),this.wroom=document.getElementById("w-room"),this.bsettings=document.getElementById("settings-button"),this.bleave=document.getElementById("leave-button"),this.settings={Mode:v.MinesweeperMode.Solo,Difficulty:v.MinesweeperDifficulty.Expert,H:16,W:30,N:99},this.wsettings=new p["default"](document.getElementById("settings"),this.settings_set.bind(this),this.settings),this.bsettings.addEventListener("click",function(){t.server.host&&t.wsettings.open(t.settings)}),this.bleave.addEventListener("click",function(){t.oncommand("part")}),this.label_set(),this.wrecords=new f["default"](document.getElementById("top-alltime"),document.getElementById("top-local"),document.getElementById("recentrecordslist")),this.wchat=new g["default"](document.querySelector("#w-list .titlebar"),document.getElementById("userlist"),document.getElementById("log"),document.getElementById("chatinput")),this.main=new h.GameWindow(this.mfield,new u.GameState(this.settings.H,this.settings.W,this.settings.N,Date.now()),this.wmain.getElementsByClassName("indicator")),this.main.on("init",this.oninit.bind(this)).on("end",this.onend.bind(this)).on("open",this.ongameevent.bind(this,"open")).on("flag",this.ongameevent.bind(this,"flag")).on("mouse",this.ongamemouse.bind(this));var i=!0,n=!1,o=void 0;try{for(var a,d=document.querySelectorAll("main > .window")[Symbol.iterator]();!(i=(a=d.next()).done);i=!0){var m=a.value;(0,l["default"])(m.querySelector(".titlebar"),m)}}catch(y){n=!0,o=y}finally{try{!i&&d["return"]&&d["return"]()}finally{if(n)throw o}}var w=this.mfield.parentElement,_=this.mfield;addResizeListener(w,function(){var e=Math.max(Math.min(w.offsetWidth/_.scrollWidth,w.offsetHeight/_.scrollHeight),1);_.style.transform="translate(-50%, -50%) scale("+e+")"});var b=Math.min(w.offsetWidth/_.scrollWidth,w.offsetHeight/_.scrollHeight);if(_.style.transform="translate(-50%, -50%) scale("+b+")",null!=window.RTCPeerConnection){this.server=new c.Server,this.server.on("connected",this.onconnected.bind(this)).on("error",s).on("users",this.online_set.bind(this)).on("records",function(){return t.wrecords.update(t.server.records)}).on("chat",this.wchat.message.bind(this.wchat)).on("broadcast",this.wchat.slog.bind(this.wchat)),this.p2p=new c.P2PManager,this.p2p.on("signal",function(e){return t.server.send({RoomP2P:e})}).on("join",this.onp2pjoin.bind(this)).on("message",this.onp2pmessage.bind(this)).on("leave",this.onp2pleave.bind(this)),this.server.on("signal",this.p2p.onsignal.bind(this.p2p)),this.wchat.on("chat",function(e){return t.server.send({Chat:e})}).on("command",this.oncommand.bind(this)).on("roomclick",this.onp2pjoinroom.bind(this)),this.p2pmouseel=[],this._enable_p2pmouse=!0;var k=localStorage.getItem("username");null!=k?this.server.connect(k,this.settings):(document.getElementById("signin").style.display="block",document.querySelector("#signin .button").addEventListener("click",function(){var e=document.querySelector("#signin input").value;t.server.connect(e,t.settings)}))}}return o(e,[{key:"onconnected",value:function(e){localStorage.setItem("username",e.Username),this.label_set(),requestAnimationFrame(function(){document.getElementById("signin").style.display="none";var e=!0,t=!1,i=void 0;try{for(var n,r=document.querySelectorAll(".online-only")[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value;s.classList.remove("online-only")}}catch(o){t=!0,i=o}finally{try{!e&&r["return"]&&r["return"]()}finally{if(t)throw i}}})}},{key:"onp2pjoinroom",value:function(e){if(this.server.room.Id===e)return this.wchat.slog("Already in room."),!0;var t=!1,i=!0,n=!1,r=void 0;try{for(var s,o=Object.values(this.server.users)[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=s.value;a.CurrentRoom.Id===e&&(this.p2p.join(a.Username,e),t=!0)}}catch(l){n=!0,r=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw r}}return t}},{key:"onp2pjoin",value:function(e,t,i){this.server.host&&this.p2p.send(t,this.mkp2psync()),i?this.wchat.rlog("Joined room "+e+"."):this.wchat.rlog(t+" joined room.");var n=this.wroom.querySelector(".listui");if(this.bleave.style.display="inline-block",i){for(;n.firstChild;)n.removeChild(n.firstChild);this.bsettings.style.display="none"}var r=(0,v.colorstr)(t),s=document.createElement("div");s.classList.add("list-entry"),s.textContent=t,s.dataset.peerid=t,s.style.color=r,n.appendChild(s);var o=document.createElement("div");o.classList.add("cursor"),o.style.display="none",o.style.color=r,o.style.zIndex="2",o.title=t,o.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120" xml:space="preserve"><path fill="inherit" d="M24.252,0.143l71.828,67.04l-34.716,2.994l19.753,43.695l-13.168,5.984L48.794,75.563L24.252,98.908V0.143"/></svg>',this.p2pmouseel[t]=o,document.body.appendChild(o)}},{key:"onp2pleave",value:function(e,t){this.wchat.rlog(t+" left room.");var i=this.wroom.querySelector(".listui"),n=i.querySelector('.list-entry[data-peerid="'+t+'"]');n&&i.removeChild(n),document.body.removeChild(this.p2pmouseel[t]),delete this.p2pmouseel[t]}},{key:"onp2pmessage",value:function(e,t,i){var n=this,r=JSON.parse(i);switch(r.TYPE){case"mouse":if(r.x===-1&&r.y===-1){this.p2pmouseel[t].style.display="none";break}this.p2pmouseel[t].style.display="block";var s=this.mfield.getBoundingClientRect();this.p2pmouseel[t].style.left=r.x*s.width-this.mfield.scrollLeft+s.left+"px",this.p2pmouseel[t].style.top=r.y*s.height-this.mfield.scrollTop+s.top+"px";break;case"init":if(this.server.host&&this.settings.Mode!==v.MinesweeperMode.Solo){var o=this.settings;this.main.init(null,new u.GameState(o.H,o.W,o.N,Date.now()),null,!0)}this.wchat.rlog(t+" reset the game.");break;case"open":if(this.server.host&&this.settings.Mode===v.MinesweeperMode.Solo)return;if(this.settings.Mode===v.MinesweeperMode.Race){if(null!=this.main.time_start)return;this.main.active=!0}this.main.state.open(r.x,r.y),this.main.state.dead&&this.wchat.rlog("BANG! "+t+" hit a mine."),requestAnimationFrame(function(){return n.main.redraw_full()});break;case"flag":if(this.server.host&&this.settings.Mode===v.MinesweeperMode.Solo||this.settings.Mode===v.MinesweeperMode.Race)return;this.main._flag(r.x,r.y,!0);break;case"end":if(!this.settings.Mode===v.MinesweeperMode.Race)break;this.main.onend(!1),this.wchat.rlog(t+" wins the race with a time of "+r.t/1e3+" s!");break;case"sync":if(t!==this.server.room.Owner)return;this.settings=r.RoomSettings,this.main.init(null,u.GameState.fromJSON(r.GameState),null,this.settings.Mode===v.MinesweeperMode.Coop||this.server.host,!1),this.main._flags_remain=r.UiState.FlagsRemaining,this.main.time_start=r.UiState.TimeStart,this.main.time_stop=r.UiState.TimeStop,null!=r.UiState.TimeStart&&requestAnimationFrame(function(){return n.main.tick()}),this.label_set();case"config":var a=r.Config;null!=a.cursor&&a.cursor!==this._enable_p2pmouse&&(this.wchat.rlog("Host "+(a.cursor?"enabled":"disabled")+" cursors."),this._enable_p2pmouse=a.cursor,this.p2p.sendall(this.server.room.Id,{TYPE:"mouse",x:-1,y:-1}))}}},{key:"mkp2psync",value:function(){return{TYPE:"sync",RoomSettings:this.settings,GameState:this.main.state,UiState:{FlagsRemaining:this.main._flags_remain,TimeStart:this.main.time_start,TimeStop:this.main.time_stop},Config:{cursor:this._enable_p2pmouse}}}},{key:"ongameevent",value:function(e,t,i){for(var n,r=arguments.length,s=Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];(n=console).log.apply(n,[e,t,i].concat(s)),this.p2p.sendall(this.server.room.Id,{TYPE:e,x:t,y:i})}},{key:"ongamemouse",value:function(e,t,i){if(this._enable_p2pmouse&&(this.server.host||this.server.room.Mode!==v.MinesweeperMode.Solo)&&this.server.room.Mode!==v.MinesweeperMode.Race)switch(e){case"move":var n=this.mfield.getBoundingClientRect(),r=(t-n.left+this.mfield.scrollLeft)/n.width,s=(i-n.top+this.mfield.scrollTop)/n.height;this.p2p.sendall(this.server.room.Id,{TYPE:"mouse",x:r,y:s});break;case"leave":this.p2p.sendall(this.server.room.Id,{TYPE:"mouse",x:-1,y:-1})}}},{key:"oninit",value:function(e){this.server.host?this.p2p.sendall(this.server.room.Id,this.mkp2psync()):this.p2p.sendall(this.server.room.Id,{TYPE:"init"})}},{key:"onend",value:function(e){if(e){var t={Username:this.server.me,Mode:this.settings.Mode,Difficulty:this.settings.Difficulty,Time:this.main.time_stop-this.main.time_start};if(t.Mode===v.MinesweeperMode.Solo&&t.Difficulty!==v.MinesweeperDifficulty.Custom){var i=JSON.parse(localStorage.getItem("record-"+t.Difficulty));(null==i||t.Time<i.Time)&&(localStorage.setItem("record-"+t.Difficulty,JSON.stringify(t)),s("A new personal record!\nTime taken: "+t.Time/1e3+" s"),this.wchat.rlog("A new personal record! Time taken: "+t.Time/1e3+" s"))}else t.Mode===v.MinesweeperMode.Race&&this.p2p.sendall(this.server.room.Id,{TYPE:"end",t:t.Time});s("You win!\nTime taken: "+t.Time/1e3+" s"),this.wchat.rlog("You win!\nTime taken: "+t.Time/1e3+" s"),this.server.host&&this.server.send({Record:t})}}},{key:"oncommand",value:function(e,t){switch(e){case"connect":this.server.connect(t?t:this.server.me,this.settings);break;case"disconnect":this.server.socket.close();break;case"join":this.onp2pjoinroom(t)||this.wchat.slog("Could not find room.");break;case"part":this.p2p.closeall(this.server.room.Id),this.server.send({RoomP2P:{Username:null}}),this.bleave.style.display="none",this.wchat.rlog("Disconnecting from other users...");break;case"setcursor":if(!this.server.host)return void this.wchat.slog("Insufficient permissions (host-only command).");"off"===t||"false"===t?(this._enable_p2pmouse=!1,this.p2p.sendall(this.server.room.Id,{TYPE:"config",Config:{cursor:!1}}),this.wchat.rlog("CONFIG: Cursors disabled."),this.p2p.sendall(this.server.room.Id,{TYPE:"mouse",x:-1,y:-1})):"on"!==t&&"true"!==t||(this._enable_p2pmouse=!0,this.p2p.sendall(this.server.room.Id,{TYPE:"config",Config:{cursor:!0}}),this.wchat.rlog("CONFIG: Cursors enabled."));break;default:this.wchat.slog("Unknown command. Try /HELP.")}}},{key:"label_set",value:function(){var e=this,t=(0,v.labelf)(this.settings);requestAnimationFrame(function(){document.getElementById("room-label").textContent=t,document.getElementById("room-owner").textContent=null!=e.server.room?e.server.room.Owner:""})}},{key:"online_set",value:function(e,t){var i=this;t&&(s("The previous host disconnected.\nYou are now the host."),this.wchat.rlog("The previous host disconnected. You are now the host.")),this.server.host&&(this.main.active=!0,this.bsettings.style.display="inline-block"),this.wchat.presences(this.server.users),requestAnimationFrame(function(){return i.label_set()})}},{key:"settings_set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(t||this.server.host)&&(Object.assign(this.settings,e),this.main.init(null,new u.GameState(this.settings.H,this.settings.W,this.settings.N,Date.now()),null,this.main.active),this.server.send({RoomUpdate:{Settings:this.settings}})),this.label_set()}}]),e}();window.manager=new w}),require.register("online.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Server=e.P2PManager=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=t("component-emitter"),u=n(l);e.P2PManager=function(e){function t(){r(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.peers={},e.peers_send={},e.room_to_peers={},e}return o(t,e),a(t,[{key:"join",value:function(e,t){var i=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=new RTCPeerConnection({iceServers:[{urls:"stun://stun.l.google.com:19302"}]});this.peers[e]=r,this.room_to_peers[t]=this.room_to_peers[t]||[],this.room_to_peers[t].push(e),r.onicecandidate=this.onicecandidate.bind(this,e,t),r.onnegotiationneeded=this.onnegotiationneeded.bind(this,e,t),r.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this,e,t);var s=r.createDataChannel(t,{negotiated:!0,id:0,ordered:!0});s.onopen=function(){i.peers_send[e]=function(e){return s.send(e)},i.emit("join",t,e,n)},s.onmessage=function(n){i.emit("message",t,e,n.data)},s.onclose=function(){i.peers.hasOwnProperty(e)&&i.peers[e].close()}}},{key:"send",value:function(e,t){this.peers_send[e](JSON.stringify(t))}},{key:"sendall",value:function(e,t){if(this.room_to_peers.hasOwnProperty(e)){var i=!0,n=!1,r=void 0;try{for(var s,o=this.room_to_peers[e][Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=s.value;this.send(a,t)}}catch(l){n=!0,r=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw r}}}}},{key:"close",value:function(e){this.peers[e].close()}},{key:"closeall",value:function(e){if(this.room_to_peers.hasOwnProperty(e)){var t=!0,i=!1,n=void 0;try{for(var r,s=this.room_to_peers[e][Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var o=r.value;this.close(o)}}catch(a){i=!0,n=a}finally{try{!t&&s["return"]&&s["return"]()}finally{if(i)throw n}}}}},{key:"onsignal",value:function(e){var t=this,i=e.Username;null==this.peers[i]&&this.join(i,e.RoomId,!1);var n=this.peers[i];e.Offer?n.setRemoteDescription(JSON.parse(e.Offer).desc).then(function(){return n.createAnswer()}).then(function(e){return n.setLocalDescription(e)}).then(function(){t.emit("signal",{Username:i,RoomId:e.RoomId,Answer:JSON.stringify({desc:n.localDescription})})})["catch"](function(e){}):e.Answer?n.setRemoteDescription(JSON.parse(e.Answer).desc)["catch"](function(e){}):e.Candidate&&n.addIceCandidate(JSON.parse(e.Candidate).candidate)["catch"](function(e){})}},{key:"onicecandidate",value:function(e,t,i){i.candidate&&this.emit("signal",{Username:e,RoomId:t,Candidate:JSON.stringify({candidate:i.candidate})})}},{key:"onnegotiationneeded",value:function(e,t,i){var n=this;this.peers[e].createOffer().then(function(t){return n.peers[e].setLocalDescription(t)}).then(function(){n.emit("signal",{Username:e,RoomId:t,Offer:JSON.stringify({desc:n.peers[e].localDescription})})})["catch"](function(e){})}},{key:"oniceconnectionstatechange",value:function(e,t,i){if(this.peers.hasOwnProperty(e)&&("disconnected"===this.peers[e].iceConnectionState||"closed"===this.peers[e].iceConnectionState)){this.emit("leave",t,e),this.peers[e].close(),delete this.peers_send[e],delete this.peers[e];var n=this.room_to_peers[t].indexOf(e);n!==-1&&(this.room_to_peers[t].splice(n,1),0===this.room_to_peers[t].length&&delete this.room_to_peers[t])}}}]),t}(u["default"]),e.Server=function(e){function t(){r(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.socket=null,e.me=null,e.room=null,e.host=!0,e.users={},e.records={Best:{},Latest:[]},e}return o(t,e),a(t,[{key:"connect",value:function(e,t){var i=this;this.socket=new WebSocket("wss://rsid.gq/mines"),this.socket.addEventListener("close",function(e){localStorage.removeItem("username"),i.emit("error","Connection failed."),i.emit("broadcast","Lost server connection. Try /CONNECT to reconnect.")}),this.socket.addEventListener("open",function(){i.socket.send(JSON.stringify({Hello:{Username:e,Room:i.room?i.room:t}}))}),this.socket.addEventListener("message",this.onmessage.bind(this))}},{key:"onmessage",value:function(e){var t=this,i=JSON.parse(e.data);if(null!=i.SrvError)return void this.emit("error","Error: "+i.SrvError);if(null!=i.RoomP2P&&this.emit("signal",i.RoomP2P),null!=i.UserSync){i.UserSync.Partial?(this.users=Object.assign(this.users,i.UserSync.Presences),Object.keys(this.users).forEach(function(e){null==t.users[e]&&delete t.users[e]})):this.users=i.UserSync.Presences;var n=!1;if(this.users.hasOwnProperty(this.me)){var r=this.room.Id;this.room=this.users[this.me].CurrentRoom,n=!this.host&&this.room.Owner===this.me&&this.room.Id===r,this.host=this.room.Owner===this.me,delete this.users[this.me]}this.emit("users",i.UserSync,n)}null!=i.RecordSync&&(i.RecordSync.Partial?(this.records.Best=Object.assign(this.records.Best,i.RecordSync.Best),this.records.Latest=(i.RecordSync.Latest||[]).concat(this.records.Latest).slice(0,10)):(this.records=i.RecordSync,null==this.records.Latest&&(this.records.Latest=[])),this.emit("records",i.RecordSync)),null!=i.Hello&&(this.me=i.Hello.Username,this.room=i.Hello.Room,this.host=!0,this.emit("connected",i.Hello)),null!=i.Chat&&(null!=i.Sender?this.emit("chat",i.Sender,i.Chat):this.emit("broadcast",i.Chat))}},{key:"send",value:function(e){null!=this.socket&&(delete e.Sender,delete e.SrvError,this.socket.send(JSON.stringify(e)))}}]),t}(u["default"])}),require.register("solver.js",function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:e.mask<t.mask?-1:e.mask>t.mask?1:0}function s(e,t){for(var i=0,n=e.length;i<n;){var s=i+n>>>1;r(e[s],t)===-1?i=s+1:n=s}return i}function o(e,t){var i=s(e,t);return(null==e[i]||0!==r(e[i],t))&&(e.splice(i,0,t),!0)}function a(e,t,i,n,r){if(0===n)throw new Error("ss_add assertion failed");for(;!(73&n);)n>>=1,t++;for(;!(7&n);)n>>=3,i++;var s={x:t,y:i,mask:n,mines:r};o(e.sets,s)&&e.todo.push(s)}function l(e,t){var i=e.todo.indexOf(t);i>-1&&e.todo.splice(i,1);var n=e.sets.indexOf(t);if(n===-1)throw new Error("tried to remove non-existent set");e.sets.splice(n,1)}function u(e,t,i,n){for(var r=[],o=t-3;o<t+3;o++)for(var a=i-3;a<i+3;a++){var l=s(e.sets,{x:o,y:a,mask:0});if(null!=e.sets[l])for(var u=e.sets[l];null!=u&&u.x===o&&u.y===a;)c({x:t,y:i,mask:n},u,!1)&&r.push(u),u=e.sets[++l]}return r}function c(e,t){var i=e.x,n=e.y,r=e.mask,s=t.x,o=t.y,a=t.mask,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Math.abs(s-i)>=3||Math.abs(o-n)>=3)a=0;else{for(;s>i;)a&=-293,a<<=1,s--;for(;s<i;)a&=-74,a>>=1,s++;for(;o>n;)a&=-449,a<<=3,o--;for(;o<n;)a&=-8,a>>=3,o++}return l&&(a^=511),r&a}function h(e){var t=e;return t=((43690&t)>>>1)+(21845&t),t=((52428&t)>>>2)+(13107&t),t=((61680&t)>>>4)+(3855&t),t=((65280&t)>>>8)+(255&t)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f=function(){function e(t,i,r,s,o,a,l,u){n(this,e),this.grid=t,this.w=i,this.h=r,this.n=s,this.state=[],this.sx=o,this.sy=a,this.rng=l,this.allow_big_perturbs=u}return d(e,[{key:"open",value:function(e,t){if(!(e>=0&&e<this.w&&t>=0&&t<this.h))throw new Error("coordinates out of range");if(this.grid[t*this.w+e])return-1;for(var i=0,n=-1;n<=1;n++)if(!(e+n<0||e+n>=this.w))for(var r=-1;r<=1;r++)t+r<0||t+r>=this.h||0===n&&0===r||this.grid[(t+r)*this.w+(e+n)]&&i++;return i}},{key:"solve",value:function(){for(var e={sets:[],todo:[]},t=0,i=[],n=0;n<this.w*this.h;n++)this.state[n]!==-2&&i.push(n);for(;;){for(var r=!1;i.length>0;){var s=i.shift(),o=s%this.w,d=~~(s/this.w);if(this.state[s]>=0){for(var f=this.state[s],m=1,p=0,v=-1;v<=1;v++)for(var y=-1;y<=1;y++)o+y<0||o+y>=this.w||d+v<0||d+v>=this.h||(this.state[s+v*this.w+y]===-1?f--:this.state[s+v*this.w+y]===-2&&(p|=m)),m<<=1;p&&a(e,o-1,d-1,p,f)}var g=u(e,o,d,1),w=!0,_=!1,b=void 0;try{for(var k,E=g[Symbol.iterator]();!(w=(k=E.next()).done);w=!0){var S=k.value,x=c(S,{x:o,y:d,mask:1},!0),C=S.mines-(this.state[s]===-1);x&&a(e,S.x,S.y,x,C),l(e,S)}}catch(O){_=!0,b=O}finally{try{!w&&E["return"]&&E["return"]()}finally{if(_)throw b}}r=!0}if(e.todo.length>0){var M=e.todo.shift();if(0===M.mines||M.mines===h(M.mask)){this.known_squares(i,M.x,M.y,M.mask,0!==M.mines);continue}var j=!0,P=!1,I=void 0;try{for(var D,N=u(e,M.x,M.y,M.mask)[Symbol.iterator]();!(j=(D=N.next()).done);j=!0){var T=D.value,L=c(M,T,!0),q=c(T,M,!0),R=h(L),G=h(q);if(R!==M.mines-T.mines&&G!==T.mines-M.mines){if(0===R&&0!==G){if(T.mines<=M.mines)throw new Error("s should be a subset of s2");a(e,T.x,T.y,q,T.mines-M.mines)}else if(0===G&&0!==R){if(M.mines<=T.mines)throw new Error("s2 should be a subset of s");a(e,M.x,M.y,L,M.mines-T.mines)}}else this.known_squares(i,M.x,M.y,L,R===M.mines-T.mines),this.known_squares(i,T.x,T.y,q,G===T.mines-M.mines)}}catch(O){P=!0,I=O}finally{try{!j&&N["return"]&&N["return"]()}finally{if(P)throw I}}r=!0}else if(this.n>=0){for(var B=0,U=this.n,A=0;A<this.w*this.h;A++)this.state[A]===-1?U--:this.state[A]===-2&&B++;if(0===B){if(0!==U)throw new Error("no squares left but mines remaining");break}if(0===U||U===B)for(var F=0;F<this.h;F++)for(var H=0;H<this.w;H++)this.state[F*this.w+H]===-2&&this.known_squares(i,H,F,1,0!==U);var W=e.sets.length;if(W<=10)for(var J=[],Y=0;;)if(Y<W){for(var z=!0,K=0;K<Y;K++)if(J[K]&&c(e.sets[Y],e.sets[K],!1)){z=!1;break}z&&(U-=e.sets[Y].mines,
B-=h(e.sets[Y].mask)),J[Y++]=z}else{if(B>0&&(0===U||U===B)){for(var $=0;$<this.w*this.h;$++)if(this.state[$]===-2){for(var Q=!0,V=$%this.w,X=~~($/this.w),Z=0;Z<W;Z++)if(J[Z]&&c(e.sets[Z],{x:V,y:X,mask:1},!1)){Q=!1;break}Q&&this.known_squares(i,V,X,1,0!==U)}r=!0;break}for(;!J[Y]&&Y>=0;)Y--;if(!(Y>=0))break;if(!J[Y])throw new Error("backtrack did not go to a true");U+=e.sets[Y].mines,B+=h(e.sets[Y].mask),J[Y++]=!1}}if(!r){var ee=!0,te=!1,ie=void 0;try{for(var ne,re=e.sets[Symbol.iterator]();!(ee=(ne=re.next()).done);ee=!0){ne.value}}catch(O){te=!0,ie=O}finally{try{!ee&&re["return"]&&re["return"]()}finally{if(te)throw ie}}if(this.perturb){var se=null;if(t++,0===e.sets.length)se=this.perturb(0,0,0);else{var oe=e.sets[this.rng.uint32_range(e.sets.length)];se=this.perturb(oe.x,oe.y,oe.mask)}if(null!=se){if(se.n<=0)throw new Error("ret should have been null");for(var ae=0;ae<se.n;ae++){se.changes[ae].delta<0&&this.state[se.changes[ae].y*this.w+se.changes[ae].x]!==-2&&i.push(se.changes[ae].y*this.w+se.changes[ae].x);var le=!0,ue=!1,ce=void 0;try{for(var he,de=u(e,se.changes[ae].x,se.changes[ae].y,1)[Symbol.iterator]();!(le=(he=de.next()).done);le=!0){var fe=he.value;e.todo.push(fe)}}catch(O){ue=!0,ce=O}finally{try{!le&&de["return"]&&de["return"]()}finally{if(ue)throw ce}}}var me=!0,pe=!1,ve=void 0;try{for(var ye,ge=e.sets[Symbol.iterator]();!(me=(ye=ge.next()).done);me=!0){ye.value}}catch(O){pe=!0,ve=O}finally{try{!me&&ge["return"]&&ge["return"]()}finally{if(pe)throw ve}}continue}}break}}for(var we=0;we<this.w*this.h;we++)if(this.state[we]===-2){t=-1;break}return t}},{key:"known_squares",value:function(e,t,i,n,r){for(var s=1,o=0;o<3;o++)for(var a=0;a<3;a++){if(n&s){var l=(i+o)*this.w+(t+a);if(this.state[l]===-2){if(r)this.state[l]=-1;else if(this.state[l]=this.open(t+a,i+o),this.state[l]===-1)throw new Error("*bang*");e.push(l)}}s<<=1}}},{key:"_dump",value:function(){for(var e="",t=0;t<this.h;t++){for(var i=0;i<this.w;i++){var n=this.state[t*this.w+i];e+=n===-1?"*":n===-2?"?":0===n?"-":""+n}e+="\n"}return e}}]),e}();e.Solver=f}),require.register("wchat.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=t("component-emitter"),u=n(l),c=t("common"),h=function(e){function t(e,i,n,o){r(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.el_title=e,a.el_list=i,a.el_log=n,a.el_chat=o,a.el_list.addEventListener("click",function(e){var t=e.path.find(function(e){return null!=e.dataset&&null!=e.dataset.roomid});t&&a.emit("roomclick",t.dataset.roomid)}),a.el_chat.addEventListener("keyup",function(e){"Enter"===e.code&&""!==a.el_chat.value&&(a.el_chat.value.startsWith("/")?a.oncommand(a.el_chat.value):a.emit("chat",a.el_chat.value),a.el_chat.value="")}),a}return o(t,e),a(t,[{key:"oncommand",value:function(e){var t=e.split(" "),i=t.shift().slice(1).toLowerCase(),n=t.join(" ");switch(i){case"help":this.slog("Available commands: /CLEAR /CONNECT /DISCONNECT /HELP /JOIN /PART /SETCURSOR");break;case"clear":for(;this.el_log.firstChild;)this.el_log.removeChild(this.el_log.firstChild);break;default:this.emit("command",i,n)}}},{key:"message",value:function(e,t){var i=e.Username,n=document.createElement("div");n.textContent=t,n.innerHTML='&lt;<span style="color:'+(0,c.colorstr)(i)+'">'+i+"</span>&gt;&nbsp;"+n.innerHTML,this.el_log.appendChild(n),this.el_log.scrollTop=this.el_log.scrollHeight}},{key:"slog",value:function(e){var t=document.createElement("div");t.style.color="#333",t.style.fontStyle="italic",t.textContent=e,this.el_log.appendChild(t),this.el_log.scrollTop=this.el_log.scrollHeight}},{key:"rlog",value:function(e){var t=document.createElement("div");t.style.color="#333",t.style.fontWeight="600",t.textContent=e,this.el_log.appendChild(t),this.el_log.scrollTop=this.el_log.scrollHeight}},{key:"presences",value:function(e){var t=this,i=[],n=!0,r=!1,s=void 0;try{for(var o,a=Object.values(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value,u=document.createElement("div");u.classList.add("list-entry","clickable");var h=document.createElement("div");h.textContent=l.Username,h.style.color=(0,c.colorstr)(l.Username),u.appendChild(h);var d=document.createElement("div");d.textContent=(0,c.labelf)(l.CurrentRoom),l.CurrentRoom.Owner!==l.Username&&(d.textContent+=" ["+l.CurrentRoom.Owner+"]"),u.appendChild(d),u.dataset.roomid=l.CurrentRoom.Id,i.push(u)}}catch(f){r=!0,s=f}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}requestAnimationFrame(function(){t.el_title.textContent="Server ("+(Object.keys(e).length+1)+" online)",t.presences_clear();var n=!0,r=!1,s=void 0;try{for(var o,a=i[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;t.el_list.appendChild(l)}}catch(u){r=!0,s=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}})}},{key:"presences_clear",value:function(){for(;this.el_list.firstChild;)this.el_list.removeChild(this.el_list.firstChild)}}]),t}(u["default"]);e["default"]=h}),require.register("wgame.js",function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.GameWindow=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=t("component-emitter"),u=n(l),c=t("throttleit"),h=n(c),d=t("common"),f=t("./engine");e.GameWindow=function(e){function t(e,i,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];r(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.init(e,i,n,o),e.addEventListener("mousedown",a.onmousedown.bind(a)),e.addEventListener("mouseup",a.onmouseup.bind(a)),e.addEventListener("mousemove",a.onmousemove.bind(a)),e.addEventListener("mousemove",(0,h["default"])(a.sendmousemove.bind(a),100)),e.addEventListener("mouseleave",function(){a._x_last=null,a._y_last=null,a.redraw_anim(),a.emit("mouse","leave",null,null)}),e.addEventListener("contextmenu",function(e){return e.preventDefault()}),document.addEventListener("keypress",a.onkeypress.bind(a)),n[1].addEventListener("click",function(){return a.active?a.reset():null}),a}return o(t,e),a(t,[{key:"init",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];for(this.root=e||this.root,this.state=t||this.state,this.active=n,this._grid=[],this.state.on("start",this.onstart.bind(this)),this.state.on("end",this.onend.bind(this));this.root.firstChild;)this.root.removeChild(this.root.firstChild);for(var s=0;s<t.h;s++){var o=document.createElement("div");o.className="row";for(var a=0;a<t.w;a++){var l=document.createElement("div");l.dataset.coord=""+a+"x"+s,this._grid[s*t.w+a]=l,this.redraw(s*t.w+a),o.appendChild(l)}this.root.appendChild(o)}this.indicator_flags=i?i[0]:this.indicator_flags,this.indicator_flags.classList.add("indicator","counter"),this._flags_remain=null,this.indicator_yellow=i?i[1]:this.indicator_yellow,this.indicator_yellow.classList.remove("dead","surprise","cool"),this.indicator_yellow.classList.add("indicator","yellow","happy"),this.indicator_clock=i?i[2]:this.indicator_clock,this.indicator_clock.classList.add("indicator","counter"),this.time_start=null,this.time_stop=null,this._chord_last=null,this._x_last=null,this._y_last=null,this._draw_queue=[],this._anim_queue=[],this.indicator_flags.textContent="!!!",this.indicator_clock.textContent="!!!",r&&this.emit("init",this.state)}},{key:"reset",value:function(){this.init(null,new f.GameState(this.state.h,this.state.w,this.state.n,Date.now()),null)}},{key:"destroy",value:function(){this.root=null,this.state=null,this._grid=null,this.time_start=null}},{key:"onstart",value:function(){var e=this;this.time_start=Date.now(),this._flags_remain=this.state.n,requestAnimationFrame(function(){return e.tick()})}},{key:"onend",value:function(e){var t=this;if(this.time_stop=Date.now(),this.emit("end",e),e)for(var i=0;i<this.state.h*this.state.w;i++)this.state.mines[i]&&this.state.grid[i]===d.GridStateEnum.Unknown&&(this.state.grid[i]=d.GridStateEnum.Flag);else for(var n=0;n<this.state.h*this.state.w;n++)this.state.mines[n]?this.state.grid[n]===d.GridStateEnum.Unknown&&(this.state.grid[n]=d.GridStateEnum.MineRevealed):this.state.grid[n]===d.GridStateEnum.Flag&&(this.state.grid[n]=d.GridStateEnum.WrongFlag);requestAnimationFrame(function(){t.indicator_yellow.classList.remove("surprise","happy"),t.indicator_yellow.classList.add(e?"cool":"dead"),t.redraw_full()})}},{key:"onmousedown",value:function(e){var t=this;if(this.active&&e.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var i=e.target.dataset.coord.split("x"),n=parseInt(i[0],10),r=parseInt(i[1],10);2===e.button&&2===e.buttons||0===e.button&&e.ctrlKey?this._flag(n,r):0===e.button&&1===e.buttons?requestAnimationFrame(function(){t.state.grid[r*t.state.w+n]===d.GridStateEnum.Unknown&&(t._grid[r*t.state.w+n].className="tile open",t._anim_queue.push(r*t.state.w+n)),t.indicator_yellow.classList.replace("happy","surprise")}):(2===e.button&&1&e.buttons||0===e.button&&2&e.buttons)&&(this._chord_last=null,requestAnimationFrame(function(){for(var e=t.state.w,i=t.state.h,s=-1;s<=1;s++)for(var o=-1;o<=1;o++)n+s>=0&&n+s<e&&r+o>=0&&r+o<i&&t.state.grid[(r+o)*e+(n+s)]===d.GridStateEnum.Unknown&&(t._grid[(r+o)*e+(n+s)].className="tile open",t._anim_queue.push((r+o)*e+(n+s)))})),e.preventDefault()}}},{key:"onmouseup",value:function(e){var t=this;if(this.active&&e.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var i=e.target.dataset.coord.split("x"),n=parseInt(i[0],10),r=parseInt(i[1],10);0===e.button&&2&e.buttons||2===e.button&&1&e.buttons||1===e.button?(this._chord(n,r),this.state.won||this.state.dead||requestAnimationFrame(function(){t.indicator_yellow.classList.remove("surprise","dead","cool"),t.indicator_yellow.classList.add("happy"),t.redraw_anim()})):0!==e.button||e.ctrlKey||this._chord_last||this._open(n,r)&&requestAnimationFrame(function(){t.indicator_yellow.classList.remove("surprise","dead","cool"),t.indicator_yellow.classList.add("happy"),t.redraw_anim()}),1&e.buttons&&2===e.button?this._chord_last=!0:this._chord_last=null,e.preventDefault()}}},{key:"onmousemove",value:function(e){var t=this;if(this.active&&e.path[0].className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var i=e.path[0].dataset.coord.split("x"),n=parseInt(i[0],10),r=parseInt(i[1],10);this._x_last===n&&this._y_last===r||(this._x_last=n,this._y_last=r,0===e.buttons||this._chord_last||requestAnimationFrame(function(){var i=t.state.w,s=t.state.h;if(t.redraw_anim(),3===(3&e.buttons))for(var o=-1;o<=1;o++)for(var a=-1;a<=1;a++)n+o>=0&&n+o<i&&r+a>=0&&r+a<s&&t.state.grid[(r+a)*i+(n+o)]===d.GridStateEnum.Unknown&&(t._grid[(r+a)*i+(n+o)].className="tile open",t._anim_queue.push((r+a)*i+(n+o)));else 1&e.buttons&&t.state.grid[r*i+n]===d.GridStateEnum.Unknown&&(t._grid[r*i+n].className="tile open",t._anim_queue.push(r*i+n))}))}}},{key:"sendmousemove",value:function(e){null==this._x_last&&null==this._y_last||this.emit("mouse","move",e.pageX,e.pageY)}},{key:"onkeypress",value:function(e){if(this.active&&!this.state.won&&!this.state.dead&&"Space"===e.code&&null!=this._x_last&&null!=this._y_last&&!e.repeat){var t=this._y_last*this.state.w+this._x_last;this.state.grid[t]===d.GridStateEnum.Unknown||this.state.grid[t]===d.GridStateEnum.Flag?this._flag(this._x_last,this._y_last):1<=this.state.grid[t]&&this.state.grid[t]<=8&&this._chord(this._x_last,this._y_last),e.preventDefault()}}},{key:"redraw_full",value:function(){for(var e=0;e<this.state.h;e++)for(var t=0;t<this.state.w;t++)this.redraw(e*this.state.w+t)}},{key:"redraw_anim",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this._anim_queue[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value;this.redraw(s)}}catch(o){t=!0,i=o}finally{try{!e&&r["return"]&&r["return"]()}finally{if(t)throw i}}}},{key:"redraw",value:function(e){switch(this.state.grid[e]){case d.GridStateEnum.Unknown:this._grid[e].className="tile closed";break;case d.GridStateEnum.Flag:this._grid[e].className="tile closed flag";break;case d.GridStateEnum.MineRevealed:this._grid[e].className="tile closed mine";break;case d.GridStateEnum.MineClicked:this._grid[e].className="tile open red mine";break;case d.GridStateEnum.WrongFlag:this._grid[e].className="tile closed nomine";break;default:this._grid[e].className="tile open n"+this.state.grid[e]}}},{key:"tick",value:function(){var e=this,t=(this.time_stop||Date.now())-this.time_start;this.indicator_clock.textContent=(""+(~~(t/1e3)+1)).padStart(3,"0"),null!=this.time_stop&&this.indicator_clock.setAttribute("title",~~(t/6e4)+":"+t/1e3%60),null!=this._flags_remain?this.indicator_flags.textContent=(""+this._flags_remain).padStart(3,"0"):(this.indicator_clock.textContent="!!!",this.indicator_flags.textContent="!!!");var i=!0,n=!1,r=void 0;try{for(var s,o=this._draw_queue[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var a=s.value;this.redraw(a)}}catch(l){n=!0,r=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw r}}null==this.time_stop&&null!=this.time_start&&requestAnimationFrame(function(){return e.tick()})}},{key:"_open",value:function(e,t){var i=this;if(this.state.grid[t*this.state.w+e]===d.GridStateEnum.Unknown){var n=this.state.open(e,t);return requestAnimationFrame(function(){return i.redraw_full()}),this.emit("open",e,t,n),n}return!0}},{key:"_flag",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t*this.state.w+e;null!=this.time_start&&(this.state.grid[n]===d.GridStateEnum.Unknown?(this.state.grid[n]=d.GridStateEnum.Flag,this._draw_queue.push(n),this._flags_remain-=1,i||this.emit("flag",e,t,1,this._flags_remain)):this.state.grid[n]===d.GridStateEnum.Flag&&(this.state.grid[n]=d.GridStateEnum.Unknown,this._draw_queue.push(n),this._flags_remain+=1,i||this.emit("flag",e,t,-1,this._flags_remain)))}},{key:"_chord",value:function(e,t){var i=this,n=this.state.w,r=this.state.h,s=t*n+e;if(null!=this.time_start&&1<=this.state.grid[s]&&this.state.grid[s]<=8){for(var o=0,a=-1;a<=1;a++)for(var l=-1;l<=1;l++)e+a>=0&&e+a<n&&t+l>=0&&t+l<r&&this.state.grid[(t+l)*n+(e+a)]===d.GridStateEnum.Flag&&o++;if(o===this.state.grid[s])for(var u=-1;u<=1;u++)for(var c=-1;c<=1;c++)if(e+u>=0&&e+u<n&&t+c>=0&&t+c<r&&this.state.grid[(t+c)*n+(e+u)]===d.GridStateEnum.Unknown){var h=this.state.open(e+u,t+c);this.emit("open",e+u,t+c,h)}requestAnimationFrame(function(){return i.redraw_full()})}}}]),t}(u["default"])}),require.register("wrecords.js",function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,i){if(null!=t){var n=document.createElement("tr");n.innerHTML="<td><em>"+i+"</em></td><td>"+t.Username+"</td><td>"+t.Time/1e3+"</td>",e.appendChild(n)}}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=t("./common"),a=function(){function e(t,i,r){n(this,e),this.alltime=t,this.local=i,this.recent=r}return s(e,[{key:"update",value:function(e){for(var t=this.alltime;t.firstChild;)t.removeChild(t.firstChild);r(t,e.Best[o.MinesweeperDifficulty.Beginner],o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Beginner)),r(t,e.Best[o.MinesweeperDifficulty.Intermediate],o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Intermediate)),r(t,e.Best[o.MinesweeperDifficulty.Expert],o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Expert)),r(t,e.Best[o.MinesweeperDifficulty.Extreme],o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Extreme));for(var i=this.local;i.firstChild;)i.removeChild(i.firstChild);r(i,JSON.parse(localStorage.getItem("record-"+o.MinesweeperDifficulty.Beginner)),o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Beginner)),r(i,JSON.parse(localStorage.getItem("record-"+o.MinesweeperDifficulty.Intermediate)),o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Intermediate)),r(i,JSON.parse(localStorage.getItem("record-"+o.MinesweeperDifficulty.Expert)),o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Expert)),r(i,JSON.parse(localStorage.getItem("record-"+o.MinesweeperDifficulty.Extreme)),o.MinesweeperDifficulty.str(o.MinesweeperDifficulty.Extreme));for(var n=this.recent;n.firstChild;)n.removeChild(n.firstChild);var s=!0,a=!1,l=void 0;try{for(var u,c=e.Latest[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=u.value,d=document.createElement("div");d.classList.add("list-entry"),d.innerHTML="<span>"+h.Username+"</span>&nbsp;<span>"+o.MinesweeperMode.str(h.Mode)+", "+o.MinesweeperDifficulty.str(h.Difficulty)+"</span>&nbsp;<span>"+(~~(h.Time/1e3)+1)+"</span>",n.appendChild(d)}}catch(f){a=!0,l=f}finally{try{!s&&c["return"]&&c["return"]()}finally{if(a)throw l}}}}]),e}();e["default"]=a}),require.register("wsettings.js",function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(e,"__esModule",{value:!0});var s,o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=t("./common"),l=(s={},r(s,a.MinesweeperDifficulty.Beginner,{H:9,W:9,N:10}),r(s,a.MinesweeperDifficulty.Intermediate,{H:16,W:16,N:40}),r(s,a.MinesweeperDifficulty.Expert,{H:16,W:30,N:99}),r(s,a.MinesweeperDifficulty.Extreme,{H:24,W:30,N:199}),s),u=function(){function e(t,i,r){n(this,e),this.root=t,this.cb=i,this.v=Object.assign({},r),document.getElementById("settings").addEventListener("click",this.click.bind(this)),document.getElementById("settings-container").addEventListener("change",this.change.bind(this)),this.update(r)}return o(e,[{key:"click",value:function(e){if("mode"===e.target.name)this.v.Mode=e.target.value;else if("difficulty"===e.target.name)this.v.Difficulty=e.target.value,e.target.value!==a.MinesweeperDifficulty.Custom&&(Object.assign(this.v,l[e.target.value]),document.getElementById("sinput-h").value=this.v.H,document.getElementById("sinput-w").value=this.v.W,document.getElementById("sinput-n").value=this.v.N);else switch(e.target.id){case"sinput-ok":this.cb(this.v);case"sinput-cancel":this.close()}}},{key:"change",value:function(e){if("number"===e.target.type)switch(this.v.Difficulty=a.MinesweeperDifficulty.Custom,document.getElementById("sradio-cus").checked=!0,e.target.name){case"h":this.v.H=parseInt(e.target.value,10);break;case"w":this.v.W=parseInt(e.target.value,10);break;case"n":this.v.N=parseInt(e.target.value,10)}}},{key:"open",value:function(e){null!=e&&this.update(e),this.root.style.visibility="visible"}},{key:"close",value:function(){this.root.style.visibility="collapse"}},{key:"update",value:function(){document.getElementById("sradio-"+this.v.Mode).checked=!0,document.getElementById("sradio-"+this.v.Difficulty).checked=!0,document.getElementById("sinput-h").value=this.v.H,document.getElementById("sinput-w").value=this.v.W,document.getElementById("sinput-n").value=this.v.N}}]),e}();e["default"]=u}),require.register("___globals___",function(e,t,i){})}(),require("___globals___");