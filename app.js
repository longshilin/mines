!function(){"use strict";var t="undefined"==typeof global?self:global;if("function"!=typeof t.require){var e={},r={},i={},n={}.hasOwnProperty,a=/^\.\.?(\/|$)/,o=function(t,e){for(var r,i=[],n=(a.test(e)?t+"/"+e:e).split("/"),o=0,s=n.length;o<s;o++)r=n[o],".."===r?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},s=function(t){return t.split("/").slice(0,-1).join("/")},u=function(e){return function(r){var i=o(s(e),r);return t.require(i,e)}},l=function(t,e){var i=_&&_.createHot(t),n={id:t,exports:{},hot:i};return r[t]=n,e(n.exports,u(t),n),n.exports},h=function(t){return i[t]?h(i[t]):t},f=function(t,e){return h(o(s(t),e))},c=function(t,i){null==i&&(i="/");var a=h(t);if(n.call(r,a))return r[a].exports;if(n.call(e,a))return l(a,e[a]);throw new Error("Cannot find module '"+t+"' from '"+i+"'")};c.alias=function(t,e){i[e]=t};var d=/\.[^.\/]+$/,m=/\/index(\.[^\/]+)?$/,v=function(t){if(d.test(t)){var e=t.replace(d,"");n.call(i,e)&&i[e].replace(d,"")!==e+"/index"||(i[e]=t)}if(m.test(t)){var r=t.replace(m,"");n.call(i,r)||(i[r]=t)}};c.register=c.define=function(t,i){if(t&&"object"==typeof t)for(var a in t)n.call(t,a)&&c.register(a,t[a]);else e[t]=i,delete r[t],v(t)},c.list=function(){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t};var _=t._hmr&&new t._hmr(f,c,e,r);c._cache=r,c.hmr=_&&_.wrap,c.brunch=!0,t.require=c}}(),function(){"undefined"==typeof window?this:window;require.register("common.js",function(t,e,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GridStateEnum=Object.freeze({Question:-3,Unknown:-2,Flag:-1,N0:0,N1:1,N2:2,N3:3,N4:4,N5:5,N6:6,N7:7,N8:8,MineRevealed:64,MineClicked:65,WrongFlag:66})}),require.register("game.js",function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0}),t.GameState=void 0;var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=e("../lib/emitter"),l=i(u),h=e("common"),f=e("generator");t.GameState=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:99,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));s.w=r,s.h=t,s.n=i,s.seed=o,s.dead=!1,s.won=!1,s.mines=null,s.grid=[];for(var u=0;u<t;u++)for(var l=0;l<r;l++)s.grid[u*r+l]=-2;return s}return o(e,t),s(e,[{key:"open",value:function(t,e){var r=this.w,i=this.h;if(!(0<=t&&t<r&&0<=e&&e<i))throw new Error("coordinate(s) out of range");if(null==this.mines&&(this.mines=f.ClassicGenerator.generate(i,r,this.n,t,e,this.seed),this.emit("start")),this.mines[e*r+t])return this.dead=!0,this.grid[e*r+t]=h.GridStateEnum.MineClicked,this.emit("end",!1),!1;var n=[];n.push({x:t,y:e});for(var a=0;a<n.length;a++){var o=n[a],s=o.x,u=o.y;if(this.mines[u*r+s])throw new Error("tried to auto-clear a mine");for(var l=0,c=-1;c<=1;c++)for(var d=-1;d<=1;d++)s+c>=0&&s+c<r&&u+d>=0&&u+d<i&&this.mines[(u+d)*r+(s+c)]&&l++;if(this.grid[u*r+s]=l,0===l)for(var m=-1;m<=1;m++)for(var v=-1;v<=1;v++)s+m>=0&&s+m<r&&u+v>=0&&u+v<i&&this.grid[(u+v)*r+(s+m)]===h.GridStateEnum.Unknown&&n.push({x:s+m,y:u+v})}for(var _=0,p=0,u=0;u<i;u++)for(var s=0;s<r;s++)this.grid[u*r+s]<0&&p++,this.mines[u*r+s]&&_++;if(p<_)throw new Error("uncovered a mine without losing?");if(p===_){for(var g=0;g<i;g++)for(var w=0;w<r;w++)this.grid[g*r+w]<0&&(this.grid[g*r+w]=h.GridStateEnum.Flag);return this.won=!0,this.emit("end",!0),!1}return!0}}]),e}(l["default"])}),require.register("generator.js",function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=[],i=0;i<e;i++)r[i]=t;return r}Object.defineProperty(t,"__esModule",{value:!0}),t.FairGenerator=t.ClassicGenerator=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function v(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:v(n,e,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),f=e("../lib/xor4096"),c=i(f),d=e("solver"),m=t.ClassicGenerator=function(){function t(){o(this,t)}return h(t,null,[{key:"generate",value:function(t,e,r,i,n,a){if(r>e*t-9)throw new Error("too many mines for grid size");for(var o=s(0,e*t),u=null==a||null==a.uint32_range?(0,c["default"])(a):a,l=s(0,e*t),h=0,f=0;f<t;f++)for(var d=0;d<e;d++)(Math.abs(f-n)>1||Math.abs(d-i)>1)&&(l[h++]=f*e+d);for(var m=r;m-- >0;){var v=u.uint32_range(h);o[l[v]]=1,l[v]=l[--h]}return o}}]),t}();t.FairGenerator=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),h(e,null,[{key:"generate",value:function(t,r,i,n,a,o){if(r<=2||t<=2)throw new Error("grid dimensions must be at least 3x3");var h="object"!==("undefined"==typeof o?"undefined":u(o))?(0,c["default"])(o):o,f=void 0,m=void 0,v=0;do{m=!1,v++,f=l(e.__proto__||Object.getPrototypeOf(e),"generate",this).call(this,t,r,i,n,a,h);for(var _=new d.Solver(f,r,t,i,n,a,h,v>100),p=void 0,g=-2;;){if(_.state=s(-2,r*t),_.state[a*r+n]=_.open(n,a),0!==_.state[a*r+n])throw new Error("Generation broken, first square not empty");if(p=_.solve(),p<0||g>=0&&p>=g){m=!1;break}if(0===p){m=!0;break}}}while(!m);return f}}]),e}(m)}),require.register("main.js",function(t,e,r){"use strict";e("../lib/dragable");var i=e("game"),n=e("ui");window.renderer=new n.GameWindow(document.getElementsByClassName("minefield")[0],new i.GameState(16,30,99),document.getElementsByClassName("indicator")),document.getElementsByClassName("yellow")[0].addEventListener("click",function(){return window.renderer.init(null,new i.GameState(16,30,99),null)})}),require.register("solver.js",function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r,n,a,o,s,u,l){i(this,t),this.grid=e,this.w=r,this.h=n,this.n=a,this.state=[],this.sx=o,this.sy=s,this.rng=u,this.allow_big_perturbs=l}return n(t,[{key:"open",value:function(t,e){if(!(t>=0&&t<this.w&&e>=0&&e<this.h))throw new Error("coordinates out of range");if(this.grid[e*this.w+t])return-1;for(var r=0,i=-1;i<=1;i++)if(!(t+i<0||t+i>=this.w))for(var n=-1;n<=1;n++)e+n<0||e+n>=this.h||0===i&&0===n||this.grid[(e+n)*this.w+(t+i)]&&r++;return r}},{key:"solve",value:function(){return 0}}]),t}();t.Solver=a}),require.register("ui.js",function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GameWindow=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=e("common");t.GameWindow=function(){function t(e,r,n){var a=this;i(this,t),this.init(e,r,n),e.addEventListener("mousedown",this.onmousedown.bind(this)),e.addEventListener("mouseup",this.onmouseup.bind(this)),e.addEventListener("mousemove",this.onmousemove.bind(this)),e.addEventListener("mouseleave",function(){a._x_last=null,a._y_last=null}),e.addEventListener("contextmenu",function(t){return t.preventDefault()}),document.addEventListener("keypress",this.onkeypress.bind(this))}return n(t,[{key:"init",value:function(t,e,r){var i=this;for(this.root=t||this.root,this.state=e||this.state,this._grid=[],this.state.on("start",this.onstart.bind(this)),this.state.on("end",this.onend.bind(this));this.root.firstChild;)this.root.removeChild(this.root.firstChild);for(var n=0;n<e.h;n++){var a=document.createElement("div");a.className="row";for(var o=0;o<e.w;o++){var s=document.createElement("div");s.className="tile closed",s.dataset.coord=""+o+"x"+n,this._grid[n*e.w+o]=s,a.appendChild(s)}this.root.appendChild(a)}this.indicator_flags=r?r[0]:this.indicator_flags,this._flags_remain=null,this.indicator_yellow=r?r[1]:this.indicator_yellow,this.indicator_clock=r?r[2]:this.indicator_clock,this.time_start=null,this.time_stop=null,this._chord_last=null,this._x_last=null,this._y_last=null,this._draw_queue=[],requestAnimationFrame(function(){i.indicator_flags.textContent="!!!",i.indicator_clock.textContent="!!!"})}},{key:"destroy",value:function(){this.root=null,this.state=null,this._grid=null,this.time_start=null}},{key:"onstart",value:function(){var t=this;this.time_start=Date.now(),this._flags_remain=this.state.n,requestAnimationFrame(function(){return t.tick()})}},{key:"onend",value:function(t){var e=this;if(this.time_stop=Date.now(),t)for(var r=0;r<this.state.h*this.state.w;r++)this.state.mines[r]&&this.state.grid[r]===a.GridStateEnum.Unknown&&(this.state.grid[r]=a.GridStateEnum.Flag);else for(var i=0;i<this.state.h*this.state.w;i++)this.state.mines[i]?this.state.grid[i]===a.GridStateEnum.Unknown&&(this.state.grid[i]=a.GridStateEnum.MineRevealed):this.state.grid[i]===a.GridStateEnum.Flag&&(this.state.grid[i]=a.GridStateEnum.WrongFlag);requestAnimationFrame(function(){e.redraw_full()})}},{key:"onmousedown",value:function(t){if(t.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var e=t.target.dataset.coord.split("x"),r=parseInt(e[0],10),i=parseInt(e[1],10);(2===t.button||0===t.button&&t.ctrlKey)&&this._flag(r,i),t.preventDefault()}}},{key:"onmouseup",value:function(t){if(t.target.className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var e=t.target.dataset.coord.split("x"),r=parseInt(e[0],10),i=parseInt(e[1],10);i*this.state.w+r;if(0!==t.buttons&&(0===t.button||2===t.button))return void(this._chord_last=t.button);var n=0===this._chord_last&&2===t.button||2===this._chord_last&&0===t.button;this._chord_last=null,n||1===t.button?this._chord(r,i):0!==t.button||t.ctrlKey||this._open(r,i),t.preventDefault()}}},{key:"onmousemove",value:function(t){if(t.path[0].className.indexOf("tile")!==-1&&!this.state.won&&!this.state.dead){var e=t.path[0].dataset.coord.split("x"),r=parseInt(e[0],10),i=parseInt(e[1],10);this._x_last===r&&this._y_last===i||(this._x_last=r,this._y_last=i)}}},{key:"onkeypress",value:function(t){if(!this.state.won&&!this.state.dead&&"Space"===t.code&&null!=this._x_last&&null!=this._y_last){var e=this._y_last*this.state.w+this._x_last;this.state.grid[e]===a.GridStateEnum.Unknown||this.state.grid[e]===a.GridStateEnum.Flag?this._flag(this._x_last,this._y_last):1<=this.state.grid[e]&&this.state.grid[e]<=8&&this._chord(this._x_last,this._y_last),t.preventDefault()}}},{key:"redraw_full",value:function(){for(var t=0;t<this.state.h;t++)for(var e=0;e<this.state.w;e++)this.redraw(t*this.state.w+e)}},{key:"redraw",value:function(t){switch(this.state.grid[t]){case a.GridStateEnum.Unknown:this._grid[t].className="tile closed";break;case a.GridStateEnum.Flag:this._grid[t].className="tile closed flag";break;case a.GridStateEnum.MineRevealed:this._grid[t].className="tile closed mine";break;case a.GridStateEnum.MineClicked:this._grid[t].className="tile open red mine";break;case a.GridStateEnum.WrongFlag:this._grid[t].className="tile closed nomine";break;default:this._grid[t].className="tile open n"+this.state.grid[t]}}},{key:"tick",value:function(){var t=this,e=(this.time_stop||Date.now())-this.time_start;this.indicator_clock.textContent=(""+(~~(e/1e3)+1)).padStart(3,"0"),null!=this.time_stop&&this.indicator_clock.setAttribute("title",~~(e/6e4)+":"+e/1e3%60),this.indicator_flags.textContent=(""+this._flags_remain).padStart(3,"0");var r=!0,i=!1,n=void 0;try{for(var a,o=this._draw_queue[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;this.redraw(s)}}catch(u){i=!0,n=u}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw n}}null==this.time_stop&&null!=this.time_start&&requestAnimationFrame(function(){return t.tick()})}},{key:"_open",value:function(t,e){var r=this;this.state.grid[e*this.state.w+t]===a.GridStateEnum.Unknown&&(this.state.open(t,e),requestAnimationFrame(function(){return r.redraw_full()}))}},{key:"_flag",value:function(t,e){var r=e*this.state.w+t;null!=this.time_start&&(this.state.grid[r]===a.GridStateEnum.Unknown?(this.state.grid[r]=a.GridStateEnum.Flag,this._draw_queue.push(r),this._flags_remain-=1):this.state.grid[r]===a.GridStateEnum.Flag&&(this.state.grid[r]=a.GridStateEnum.Unknown,this._draw_queue.push(r),this._flags_remain+=1))}},{key:"_chord",value:function(t,e){var r=this,i=this.state.w,n=this.state.h,o=e*i+t;if(null!=this.time_start&&1<=this.state.grid[o]&&this.state.grid[o]<=8){for(var s=0,u=-1;u<=1;u++)for(var l=-1;l<=1;l++)t+u>=0&&t+u<i&&e+l>=0&&e+l<n&&this.state.grid[(e+l)*i+(t+u)]===a.GridStateEnum.Flag&&s++;if(s===this.state.grid[o])for(var h=-1;h<=1;h++)for(var f=-1;f<=1;f++)t+h>=0&&t+h<i&&e+f>=0&&e+f<n&&this.state.grid[(e+f)*i+(t+h)]===a.GridStateEnum.Unknown&&this.state.open(t+h,e+f);requestAnimationFrame(function(){return r.redraw_full()})}}}]),t}()}),require.register("___globals___",function(t,e,r){})}(),require("___globals___");